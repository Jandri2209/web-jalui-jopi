---
layout: base.njk
title: C√≥mo llegar
lang: es
permalink: /como-llegar/
alt: {"en": "/en/getting-here/", "fr": "/fr/comment-arriver/"}
---

{% set addr = (site.address | replace("¬∑"," ") | trim) %}
{% set qAddr = addr | urlencode %}
{% set pid = site.placeId %}
{% set hasCoords = site.lat and site.lng %}
{% set zoom = 16 %}

{% if hasCoords %}
  {% set qCoords = site.lat ~ "," ~ site.lng %}
{% else %}
  {% set qCoords = "" %}
{% endif %}

{# Enlace externo a Google Maps #}
{% if pid %}
  {% set mapsHref = "https://www.google.com/maps/search/?api=1&query=" ~ (hasCoords and qCoords or qAddr) ~ "&query_place_id=" ~ pid %}
{% else %}
  {% set mapsHref = "https://www.google.com/maps/search/?api=1&query=" ~ (hasCoords and qCoords or qAddr) %}
{% endif %}

<section class="section">
  <h1>{{ i18n.es.HowToGetHere }}</h1>

  <div class="gethere-grid">
    <div class="card contact-box">
      <h3>{{ i18n.es.Address }}</h3>
      <p>üìç {{ site.address }}</p>

      <div class="cta-row">
        <a class="btn" href="tel:{{ site.phone | replace(' ','') }}">üìû {{ i18n.es.Call }}</a>
        <a class="btn alt" href="mailto:{{ site.email }}">‚úâ {{ i18n.es.Write }}</a>
      </div>

      <a class="btn wide" href="{{ mapsHref }}" target="_blank" rel="noopener">
        {{ i18n.es.OpenInMaps or "Abrir en Google Maps" }}
      </a>
    </div>

    <div class="map-card">
      <div class="map-embed" style="position:relative">
        <!-- Mapa interactivo sin cookies -->
        <div id="map" aria-label="Mapa ‚Äî {{ site.address }}"></div>
      </div>
      <p class="map-note">{{ i18n.es.MapNote or "Ampl√≠a el mapa para ver accesos y aparcamiento." }}</p>
    </div>
  </div>
</section>

<!-- Leaflet CSS (SRI correcto) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>
<!-- Leaflet JS (SRI correcto) -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>

<script>
(function(){
  const el = document.getElementById('map');
  if (!el) return;

  // Si Leaflet no carg√≥ por CSP/SRI, mostramos fallback
  if (typeof L === 'undefined') {
    el.innerHTML = '<div style="padding:1rem; text-align:center; color:#9aa2ad">No se pudo cargar el mapa. <a href="{{ mapsHref }}">Abrir en Google Maps</a></div>';
    el.style.minHeight = '280px';
    return;
  }

  // Tama√±os seguros
  el.style.width = '100%';
  el.style.height = '100%';
  el.style.minHeight = '340px';   // por si el aspect-ratio no aplica
  el.style.borderRadius = '12px';
  el.style.overflow = 'hidden';

  const LAT = parseFloat('{{ site.lat or "42.0738" }}');
  const LNG = parseFloat('{{ site.lng or "-1.5158" }}');
  const ZOOM = {{ zoom }};

  const map = L.map(el, { zoomControl: true, scrollWheelZoom: false })
               .setView([LAT, LNG], ZOOM);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 20,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const marker = L.marker([LAT, LNG]).addTo(map);
  marker.bindPopup('Jalui Jopi');

  // Asegura c√°lculo correcto si el contenedor cambia de tama√±o
  setTimeout(() => { map.invalidateSize(); }, 0);
  window.addEventListener('resize', () => map.invalidateSize(), { passive: true });

  // En m√≥vil, mueve un pel√≠n para que el popup no tape el pin
  if (window.innerWidth < 700) map.panBy([0, 40], { animate: false });
})();
</script>

