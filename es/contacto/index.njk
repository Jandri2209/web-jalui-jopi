---
layout: base.njk
title: Contacto
lang: es
permalink: /contacto/
alt: {"en": "/en/contact/", "fr": "/fr/contact/"}
---

<section class="section">
  <h1>{{ i18n.es.FormTitle }}</h1>
  <p class="lead">{{ i18n.es.FormIntro }}</p>

  <form id="contact-form" class="contact-form card"
        name="contacto-jalui"
        method="POST"
        action="/gracias/"
        data-netlify="true"
        netlify-honeypot="bot-field"
        accept-charset="UTF-8"
        autocomplete="off">

    <!-- Netlify -->
    <input type="hidden" name="form-name" value="contacto-jalui">
    <input type="hidden" name="subject" value="Nuevo mensaje desde la web (ES)">
    <input type="hidden" name="lang" value="es">

    {# Honeypot oculto: NO borrar #}
    <p class="sr-only" aria-hidden="true">
      <label>Si ves este campo, déjalo vacío
        <input type="text" name="bot-field" tabindex="-1" autocomplete="off">
      </label>
    </p>

    <label for="name">{{ i18n.es.Name }}</label>
    <input id="name" name="name" required autocomplete="name">

    <label for="email">{{ i18n.es.Email }}</label>
    <input id="email" type="email" name="email" required autocomplete="email" inputmode="email">

    <label for="reason">{{ i18n.es.Reason }}</label>
    <select id="reason" name="reason" autocomplete="off">
      <option value="Consulta general">Consulta general</option>
      <option value="Reserva de grupo">Reserva de grupo</option>
      <option value="Sugerencia">Sugerencia</option>
    </select>

    <!-- ===== Campos extra para "Reserva de grupo" (presentes en build) ===== -->
    <fieldset id="group-fields-es" hidden aria-hidden="true">
      <legend class="sr-only">Detalles de la reserva de grupo</legend>

      <label for="guests-es">Número de comensales</label>
      <select id="guests-es" name="guests" autocomplete="off">
        <option value="">Selecciona…</option>
        {% for n in [6,8,10,12,15,20,25,30] %}
          <option value="{{ n }}">{{ n }}</option>
        {% endfor %}
        <option value="30+">30+</option>
      </select>

      <label for="date-es">Fecha preferida</label>
      <input id="date-es" name="preferred_date" type="date" inputmode="numeric" autocomplete="off">

      <label for="time-es">Hora preferida</label>
      <input id="time-es" name="preferred_time" type="time" inputmode="numeric" autocomplete="off">
    </fieldset>

    <label for="message">{{ i18n.es.Message }}</label>
    <textarea id="message" name="message" rows="6" required></textarea>

    <div class="checkbox">
      <input id="privacy" name="privacy" type="checkbox" value="accepted" required>
      <label for="privacy">He leído y acepto la <a href="/privacidad/">política de privacidad</a>.</label>
    </div>

    {# reCAPTCHA de Netlify #}
    <div data-netlify-recaptcha="true"></div>

    <div id="form-status-es" class="sr-only" aria-live="polite"></div>
    <button class="btn" type="submit">{{ i18n.es.Send }}</button>
  </form>
</section>

<script>
(() => {
  const form = document.getElementById('contact-form');
  if (!form) return;

  const reasonSel = form.querySelector('#reason');
  const groupBox  = form.querySelector('#group-fields-es');
  const guests    = form.querySelector('#guests-es');
  const date      = form.querySelector('#date-es');
  const time      = form.querySelector('#time-es');

  function isGroup() {
    return reasonSel && reasonSel.value === 'Reserva de grupo';
  }

  function toggleGroupFields() {
    const on = isGroup();
    groupBox.hidden = !on;
    groupBox.setAttribute('aria-hidden', String(!on));
    [guests, date, time].forEach(el => {
      if (!el) return;
      if (on) el.setAttribute('required', 'required');
      else el.removeAttribute('required');
    });
  }

  reasonSel.addEventListener('change', toggleGroupFields);
  toggleGroupFields(); // estado inicial

  // UX envío
  const btn = form.querySelector('button[type="submit"]');
  const status = form.querySelector('#form-status-es');

  form.addEventListener('submit', () => {
    if (btn){
      btn.dataset.txt = btn.textContent;
      btn.textContent = 'Enviando…';
      btn.disabled = true;
    }
    if (status){
      status.textContent = 'Enviando tu mensaje…';
    }
  });

  // BFCache (navegar atrás)
  window.addEventListener('pageshow', (e) => {
    if (e.persisted && btn){
      form.reset();
      toggleGroupFields();
      btn.disabled = false;
      btn.textContent = btn.dataset.txt || 'Enviar';
      if (status) status.textContent = '';
    }
  });
})();
</script>
