{% set T = i18n[lang] %}

{# rutas por idioma #}
{% if lang == 'en' %}
  {% set homeHref = '/en/' %}
  {% set menuHref = '/en/menu/' %}
  {% set contactHref = '/en/contact/' %}
  {% set mapHref = '/en/getting-here/' %}
{% elif lang == 'fr' %}
  {% set homeHref = '/fr/' %}
  {% set menuHref = '/fr/carte/' %}
  {% set contactHref = '/fr/contact/' %}
  {% set mapHref = '/fr/comment-arriver/' %}
{% else %}
  {% set homeHref = '/' %}
  {% set menuHref = '/carta/' %}
  {% set contactHref = '/contacto/' %}
  {% set mapHref = '/como-llegar/' %}
{% endif %}

{# helpers activos por prefijo #}
{% set u = page.url %}
{% set isHome = (u == homeHref) %}
{% set isMenu = (u | slice(0, menuHref | length)) == menuHref %}
{% set isContact = (u | slice(0, contactHref | length)) == contactHref %}
{% set isMap = (u | slice(0, mapHref | length)) == mapHref %}

<header class="site-header">
  <div class="container">
    <div class="header-row">
      <a href="{{ homeHref }}" class="brand" aria-label="Discobar Jalui Jopi">
        <img src="/assets/brand/logo-jalui.png" alt="Discobar Jalui Jopi">
        <span>Jalui Jopi</span>
      </a>

      <button class="menu-toggle" aria-expanded="false" aria-controls="primary-nav">
        <span class="sr-only">Abrir men√∫</span>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <nav id="primary-nav" class="main-nav" aria-label="Primary">
        <a href="{{ homeHref }}"    class="{{ 'is-active' if isHome else '' }}">{{ T.Inicio }}</a>
        <a href="{{ menuHref }}"    class="{{ 'is-active' if isMenu else '' }}">{{ T.Carta }}</a>
        <a href="{{ contactHref }}" class="{{ 'is-active' if isContact else '' }}">{{ T.Contacto }}</a>
        <a href="{{ mapHref }}"     class="{{ 'is-active' if isMap else '' }}">{{ T.ComoLlegar }}</a>
      </nav>

      {% include "partials/lang-switch.njk" %}
    </div>
  </div>
</header>

{# JS hamburguesa #}
<script>
(function(){
  const btn = document.querySelector('.menu-toggle');
  const nav = document.getElementById('primary-nav');
  if(!btn || !nav) return;
  btn.addEventListener('click', () => {
    const open = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!open));
    nav.classList.toggle('is-open', !open);
    document.body.classList.toggle('no-scroll', !open);
  });
  nav.addEventListener('click', e => {
    if(e.target.tagName === 'A'){
      btn.setAttribute('aria-expanded','false');
      nav.classList.remove('is-open');
      document.body.classList.remove('no-scroll');
    }
  });
})();
</script>
