{% set T = i18n[lang] %}

{# rutas por idioma #}
{% set homeHref = '/' ~ lang ~ '/' %}
{% if lang == 'en' %}
  {% set menuHref = '/en/menu/' %}
  {% set contactHref = '/en/contact/' %}
  {% set mapHref = '/en/how-to-get-here/' %} {# o '/en/getting-here/' si ese es tu slug real #}
{% elif lang == 'fr' %}
  {% set menuHref = '/fr/carte/' %}
  {% set contactHref = '/fr/contact/' %}
  {% set mapHref = '/fr/comment-arriver/' %}
{% else %}
  {% set menuHref = '/es/carta/' %}
  {% set contactHref = '/es/contacto/' %}
  {% set mapHref = '/es/como-llegar/' %}
{% endif %}

{# helpers activos por prefijo #}
{% set u = page.url %}
{% set isHome = (u == homeHref) %}
{% set isMenu = (u | slice(0, menuHref | length)) == menuHref %}
{% set isContact = (u | slice(0, contactHref | length)) == contactHref %}
{% set isMap = (u | slice(0, mapHref | length)) == mapHref %}

<header class="site-header">
  <div class="container">
    <div class="header-row">
      <a href="{{ homeHref }}" class="brand" aria-label="Jalui Jopi">
        <picture>
          <source media="(prefers-color-scheme: dark)"
                  srcset="/assets/brand/jalui_logo_kit/png/logo-dark@1x.png 1x,
                          /assets/brand/jalui_logo_kit/png/logo-dark@2x.png 2x">
          <img src="/assets/brand/jalui_logo_kit/png/logo-light@1x.png" width="40" height="40" alt="Jalui Jopi">
        </picture>
        <span>Jalui Jopi</span>
      </a>

      <button class="menu-toggle" aria-expanded="false" aria-controls="primary-nav">
        <span class="sr-only">Abrir menú</span>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <nav id="primary-nav" class="main-nav" aria-label="Primary">
        <a href="{{ homeHref }}"    class="{{ 'is-active' if isHome else '' }}">{{ T.NavHome    or 'Inicio' }}</a>
        <a href="{{ menuHref }}"    class="{{ 'is-active' if isMenu else '' }}">{{ T.NavMenu    or 'Carta' }}</a>
        <a href="{{ contactHref }}" class="{{ 'is-active' if isContact else '' }}">{{ T.NavContact or 'Contacto' }}</a>
        <a href="{{ mapHref }}"     class="{{ 'is-active' if isMap else '' }}">{{ T.NavHow     or 'Cómo llegar' }}</a>
      </nav>

      {% include "partials/lang-switch.njk" %}
    </div>
  </div>
</header>

{# JS hamburguesa #}
<script>
(function(){
  const btn = document.querySelector('.menu-toggle');
  const nav = document.getElementById('primary-nav');
  if(!btn || !nav) return;
  btn.addEventListener('click', () => {
    const open = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!open));
    nav.classList.toggle('is-open', !open);
    document.body.classList.toggle('no-scroll', !open);
  });
  nav.addEventListener('click', e => {
    if(e.target.tagName === 'A'){
      btn.setAttribute('aria-expanded','false');
      nav.classList.remove('is-open');
      document.body.classList.remove('no-scroll');
    }
  });
})();
</script>
